
<!DOCTYPE html>
<html>

 <base id="baseURL" href="/" />
<script>
	// Dynamic Base URL
	function getBase(){
		excludedSites = ["127.0.0.1:4000", "www.mydomain.org"];
		baseURL = document.getElementById('baseURL');
		if (excludedSites.indexOf(window.location.host) > -1){
			baseURL.href="/app/docs";
		} else {
			baseURL.href="";
		}
	}
	getBase();
</script>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <img class="" alt="eGov" src="../../../../images/egovernmentslogo.png" height="55" align=right>
  <title>Indexer service</title>
  <meta name="description" content="Indexer">
  <!-- CDN's-->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,600,700" >
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" >
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <script type="text/javascript" src="js/bootstrap.min.js?05032018"></script>
  <script type="text/javascript" src="js/owl.carousel.min.js?05032018"></script>
  <script type="text/javascript" src="js/jquery.tocLight.js?05032018"></script>

  <!-- <link rel="canonical" href="http://localhost:4000/indexer/2018/02/01/Indexer-Service.html"> -->
  <!-- <link rel="alternate" type="application/rss+xml" title="eGovernments foundations" href="http://localhost:4000/feed.xml"> -->


  <body id="body">
 <div class="container inner container-height docs">
<header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/" >eGovernments foundations</a>
    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">

        
          
        
          
          <a class="page-link" href="/app/docs/docs.html">Documentation</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>



    <div class="container-fluid">
      <div class="row">
      <nav class="sidebar-container" id="mobile-dropdown" class="col-lg-3">
        <div >
          	<div id="">
	
	<div class="sidebar-wrapper " style="{color=brown}">
		<div class="" >
		 <a href="/app/docs/aboutdigit" >
				<h4 class="sidebar-group-title" >About digit</h4>
			</a>
			<ul class="sidebar-group aboutdigit">
				<li>
					<a href="/app/docs/aboutdigit/overview/">Overview</a>
				</li>
				<li>
					<a href="/app/docs/aboutdigit/philosophy/">Philosophy</a>
				</li>
				<li>
					<a href="/app/docs/aboutdigit/whatsnew/">Whats New</a>
				</li>
     </ul>

		 <a href="/app/docs/architecture">
		 	<h4 class="sidebar-group-title">Architecture</h4>
		 </a>

		 <ul class="sidebar-group architecture">
		 	<li>
		 		<a href="/app/docs/architecture/overview/">Overview</a>
		 	</li>
		 	<li>
		 		<a href="/app/docs/architecture/design/">Design</a>
		 	</li>
		 	<li>
		 		<a href="/app/docs/architecture/logicalview/">Logical view</a>
		 	</li>
		 <li>
		 		<a href="/app/docs/architecture/technicalview/">Technicl view</a>
		 	</li>
		 </ul>

		 	<a href="/app/docs/apisandusage">
		 				<h4 class="sidebar-group-title" target="_blank">APIs and Usage</h4>
		 			</a>
		 			<ul class="sidebar-group apisandusage" target="_blank">
		 				<li>
		 					<a href="/app/docs/apisandusage/userservice/" target="_blank">User Service</a>
		 				</li>
		 				<li>
		 					<a href="/app/docs/apisandusage/useroTPservice/" target="_blank">User OTP Service</a>
		 				</li>
		 				<li>
		 					<a href="/app/docs/apisandusage/employeeservice/" target="_blank">Employee Service</a>
		 				</li>
		 				<li>
		 					<a href="/app/docs/apisandusage/employeeassignment/" target="_blank">EmployeeAssignment</a>
							<li>
								<a href="/app/docs/apisandusage/payments/" target="_blank">Payments</a>
							</li>
							<li>
								<a href="/app/docs/apisandusage/billing/" target="_blank">Billing</a>
							</li>
							<li>
								<a href="/app/docs/apisandusage/boundary/" target="_blank">Boundary</a>
							</li>
							<li>
								<a href="/app/docs/apisandusage/tenant/" target="_blank">Tenant</a>
							</li>
		 				</li>
		 			</ul>

					<a href="/app/docs/frameworkcomponents">
						<h4 class="sidebar-group-title">Framework Components</h4>
					</a>
					<ul class="sidebar-group frameworkcomponents">
						<li>
							<a href="/app/docs/frameworkcomponents/mdms/">MDMS</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/report/">Report</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/persistor/">Persistor</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/indexer/">Indexer</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/notification/">Notification</a>
						</li>

						<li>
							<a href="/app/docs/frameworkcomponents/localization/">Localization</a>
						</li>

						<li>
							<a href="/app/docs/frameworkcomponents/uiframework/">UI Framework</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/gis/">GIS</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/accesscontrolservice/">Access Control Service</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/dataencryption/">Data Encryption</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/fileservice/">File Service</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/workflowengine/">Workflow Engine</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/search/">Search As a Service</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/datauploader/">Data Uploader</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/apigateway/">API Gateway</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/integration/">Integration</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/pollingservice/">Polling Service</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/auditframework/">Audit Framework</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/dashboard/">Dashboard</a>
						</li>
						<li>
							<a href="/app/docs/frameworkcomponents/validator/">Validator</a>
						</li>
					</ul>

      <a href="/app/docs/usecases">
				<h4 class="sidebar-group-title">Use Cases</h4>
			</a>
			<ul class="sidebar-group environmentsetup">
				<li>
					<a href="/app/docs/usecases/pgr/">PGR</a>
				</li>
		</ul>

			<a href="/app/docs/environmentsetup">
				<h4 class="sidebar-group-title">Environment Setup</h4>
			</a>
			<ul class="sidebar-group environmentsetup">
				<li>
					<a href="/app/docs/environmentsetup/prerequsities/">Pre Requsities</a>
				</li>
				<li>
					<a href="/app/docs/environmentsetup/installationsteps/">Installation Steps</a>
				</li>
				</ul>
</div>
</div>
<!-- <script>
$("a[href$='indexer/2018/02/01/Indexer-Service.html']").addClass("sidebar-link-selected");
</script> -->


<script>
$("a[href$='indexer/2018/02/01/Indexer-Service.html']").addClass("sidebar-link-selected");
</script>

        </div>
      </nav>
      <div class="col-lg-9">
          <div class="inner__content header" id="heading">
            <h1> </h1>
          </div>

          <div id="main-content" class="inner__content">
              <p><b>Indexer</b></p>

<p class="text-justify">The eGov Indexer allows third party developers to index data through a set of configurations. The service allows configuration of details like the data to be configured and written on the indexer service without the need to create indexer components for individual modules. The service is designed to perform all the indexing tasks of the egov platform. The service reads records posted on specific kafka topics and picks the corresponding index configuration from the yaml file provided by the respective module.</p>
<p class="text-justify">The configurations of indexer allows for the following
Multiple indexes of a record posted on a single topic.
Provision for custom index id.
Performs both bulk and non-bulk indexing.
Supports custom json indexing with field mappings, Enrichment of the input object on the queue.
Performs Elastic Search down handling.</p>
<p><b>Architecture of Indexer</b>
<img src="/images/Indexer arch.png" alt="mdms architecture" class="img-responsive" /></p>

<p class="text-justify">Indexer service is a common component, which will pick the request from KAFKA queue based on configured topic names in yml configuration, and process the request against yml configurations, if the uriMapping is configured, then the indexer calls the specified api with configured details. Once the indexer receives the response, it will map the response data to json, which is specified in index mapping and index the json data. The Indexer service will pull all configurations from git, which are specified in the path, and store in cache on loading the service.</p>
<p><b>Indexer yml configuration structure</b></p>
<pre>
  <b>The eGov Indexer provides following configurations:</b><br />
<b> - mappings:</b> List of mappings between topic name and respective index configurations.<br />
<b> - topic:</b> The topic on which the input json will be received, This will be the parent topic for the list of index configs.<br />
<b> - indexes:</b> List of index configuration to be applied on the input json received on the parent topic.<br />
<b> - name:</b> name of the index.<br />
<b> - type:</b> document type.<br />
<b> - id:</b> Json path of the id to be used as index id while indexing. This takes comma separated Json paths to build custom index id. Values will be fetched from the json path and concatenated to form the indexId.<br />
<b> - isBulk:</b> boolean value to signify if the input is a json array or json object, true in the first case, false otherwise.<br /> <b>Note:</b> if isBulk = true, indexer will accept only array of json objects as input.<br />
<b> - jsonPath:</b> Json Node path in case just a piece of the input json is to be indexed.<br />
<b> - customJsonMapping:</b> Set of mappings for building an entirely new json object to index onto ES.<br />
<b> - indexMapping:</b> Sample output json which will get indexed on to ES. This has to be provided by the respective module, if not provided, framework will fetch it from the ES. It is recommended to provide this.<br />
<b> - fieldMapping:</b> This is a list of mappings between fields of input and output json namely: inJsonPath and outJsonPath. It takes inJsonPath value from input json and puts it to outJsonPath field of output json.
<b> - uriMapping:</b> This takes uri, queryParam, pathParam and apiRequest as to first build the uri and hit the service to get the response and then takes a list of fieldMappings as above to map fields of the api response to the fields of output json.

 <b>Note:</b> "$" is to be specified as place holder in the uri path wherever the pathParam is to be substituted in order. queryParams should be comma separated.
</pre>
<p><b>Example:</b></p>
<pre>
ServiceMaps:
 serviceName: Water Charges (Module name)
 version: 1.0.0
 mappings:
  - topic: egov.wcms.newconnection-create (KAFKA topic)
    indexes:
    - name: watercharges	 (Indexer name)
      type: consumerdetails 	 (Indexer type)
      id: $.Connection.id,$.Connection.tenantId (The data is indexed based on this id. If it is not provided then the indexer will create one id and index the data)
      isBulk: false
      jsonPath: (If part of data is to be indexed then configure details below in custom json mapping)
      customJsonMapping:
        indexMapping: {"ConnectionIndex":{"ConnectionDetailsEs":{"id":13567,"connectionType":"PERMANENT","applicationType":"NEWCONNECTION","hscPipeSizeType":19.05,"pipesizeId":18,"executionDate":null,"supplyType":"SemiBulkType","noOfFlats":0,"supplyTypeId":11}}} 	(Sample Json, in which data is mapped from json paths configured below)
        fieldMapping:
        - inJsonPath: $.Connection.supplyType (Input json path)
          outJsonPath: $.ConnectionIndex.ConnectionDetailsEs.supplyType (data mapping from input json to sample json)
        - inJsonPath: $.Connection.hscPipeSizeType
          outJsonPath: $.ConnectionIndex.ConnectionDetailsEs.hscPipeSizeType
 uriMapping: (to be configured If the data which is to be indexed, is to get from any other api)
     - path: http://hr-employee:8080/hr-employee/employees/73/positions/_search (api from which data is to be fetched)
       queryParam: tenantId = $.Connection.tenantId (Comma separated query params)
       pathParam: $.Connection.id (comma separated path params)
       apiRequest: {"RequestInfo": {"apiId": "org.egov.pt","ver": "1.0","ts": 1502890899493,"action": "asd","did": "4354648646","key": "xyz","msgId": "654654", "requesterId": "61",
       "authToken": "750d4aa9-2436-4bc4-a8f4-3796e3bfd465","userInfo":{"id":73}}}(Sample api request body)
       uriResponseMapping:		(Response mapping)
       - inJsonPath: $.Position[0].id	(From path)
         outJsonPath: $.ConnectionIndex.ConnectionDetailsEs.hscPipeSizeType (To path)
       - inJsonPath: $.Position[0].deptdesig.designation.name
         outJsonPath: $.ConnectionIndex.ConnectionDetailsEs.connectionType
</pre>

<p><b>Configurations</b></p>

<p class="text-justify">Add the module specific configuration location path in the application.properties of the Indexer Service. The Indexer service will pull all configurations from git, which are specified in the path, and store in cache on loading the service. So after all configurations build and deploy Indexer service through jenkins.</p>
<p><b>Example:</b></p>

<p>egov.indexer.yml.repo.path=https://raw.githubusercontent.com/egovernments/egov-services/master/core/egov-indexer/src/main/resources/swm-service-indexer.yml,https://raw.githubusercontent.com/egovernments/egov-services/master/core/egov-indexer/src/main/resources/watercharges-indexer.yml
The highlighted path is an example of how configuration for a new module can be added</p>

<p><b>Calling Indexer component</b></p>

<p class="text-justify">Indexer service works on an asynchronous mode, that allows individual applications to write the object to be indexed in the Kafka queue under a topic name that is configured in the application specific yaml configuration. The steps for using Indexer are mentioned below</p>
<p>Business Application Responsibility
Business Application performs the required business validations and process
Creates the model object to be indexed.
Pushes the model object to the Kafka queue with the topic name configured in the Indexer yml configuration under the key [KEY_NAME]</p>

<p class="text-justify">Indexer Responsibility
Indexer service will be listening to the Kafka queue for objects published under the topic configured in the indexer yml configuration under the key [KEY_NAME]
Indexer picks up the object and uses the following configurations to to process the data and index.</p>
<p class="text-justify">As both Persister and Indexer services are maid to store the data, If there is a requirement to store the data both in database as well as in indexer. In that case we can configure the same topic in both services, so that both will be listening to the same topic, once they will find the topic, both services start doing their respective tasks.</p>
<p><b>Testing Indexer component</b></p>

<p class="text-justify">Indexer can be tested by initiating a create api from postman, with respective request, which is configured in indexer for create. If validation and business logic executes successfully, the request is sent to kafka queue with unique topic name. After placing the request in to kafka queue, the api will give the response back with successful status and sequence generated ids or code(Unique key).</p>

        </div>
      </div>
    </div>
    </div>
</div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">eGovernments foundations</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>eGovernments foundations</li>
          <li><a href="mailto:kusumasreeramulu@gmail.com">kusumasreeramulu@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/jekyll"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">jekyll</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/jekyllrb"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">jekyllrb</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>eGovernments Foundation transforms urban governance with the use of scalable and replicable technology solutions that enable efficient and effective municipal operations, better decision making, and contact-less urban service delivery..
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
